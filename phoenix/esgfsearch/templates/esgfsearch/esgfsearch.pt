<metal:block use-macro="main_template">

  <div metal:fill-slot="css">
    <!-- tags -->
    <link rel="stylesheet" href="${request.static_path('phoenix:static/bootstrap-tagmanager/bootstrap-tagmanager.css')}"/>
    <link rel="stylesheet" href="${request.static_url('phoenix:static/phoenix/css/tags.css')}"/>
  </div>

  <div metal:fill-slot="javascript">
    <!-- tags -->
    <script src="${request.static_path('phoenix:static/bootstrap-tagmanager/bootstrap-tagmanager.js')}"
            type="text/javascript"></script>
    <!-- phoenix esgf search -->
    <script src="${request.static_url('phoenix:static/phoenix/js/esgfsearch.js')}"
            type="text/javascript"></script>
    <script>
        $.EsgDatasetSearch( {
          oid: 'esgfsearch',
          url: '${request.current_route_path(_query=[])}',
          constraints: "${constraints}",
          categories: "${categories}",
          keywords: "${keywords}",
          pinnedFacets: "${pinned_facets}",
          selectedFacet: '${selected}',
        });
    </script>
  </div>

  <div metal:fill-slot="content">
    <div class="container">

      <div tal:condition="quickview" class="page-header">
        <h1>ESGF Search</h1>
      </div>

      <div class="row">
        <div class="container"
             tal:define="true_val 'true'">
          <div class="row">

            <!-- sidebar column -->

            <div class="col-md-3">

              <div class="panel-group" role="tablist" aria-multiselectable="true">

                <!-- freetext search -->
                <div class="panel panel-default">
                  <div class="panel-heading" role="tab" id="heading-text">
                    <h4 class="panel-title">
                      <a data-toggle="collapse" href="#collapse-text" aria-expanded="false" aria-controls="collapse-text">
                        <i class="fa fa-chevron-right"></i> TEXT
                      </a>
                    </h4>
                  </div>
                  <div id="collapse-text" class="panel-collapse collapse" role="tabpanel" aria-labelledby="heading-text">
                    <div class="panel-body">
                      <div class="input-group">
                        <input type="text" class="form-control" name="query" value="${query}" placeholder="Search datasets..."
                               id="esgfsearch-query"/>
                        <span class="input-group-btn">
                          <button class="btn btn-primary" type="submit"><i class="fa fa-search"></i></button>
                        </span>
                      </div>
                    </div>
                  </div>
                </div>

                <!-- options -->
                <div class="panel panel-default">
                  <div class="panel-heading" role="tab" id="heading-options">
                    <h4 class="panel-title">
                      <a data-toggle="collapse" href="#collapse-options" aria-expanded="false" aria-controls="collapse-options">
                        <i class="fa fa-chevron-down"></i> OPTIONS
                      </a>
                    </h4>
                  </div>
                  <div id="collapse-options" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="heading-options">
                    <div class="panel-body">
                      <div class="checkbox">
                        <label>
                          <input type="checkbox" name="distrib" value="${true_val}"
                                 tal:attributes="checked distrib == true_val;"
                                 id="esgfsearch-distrib"/>
                          Distributed Search
                        </label>
                      </div>

                      <div class="checkbox">
                        <label>
                          <input type="checkbox" name="replica" value="${true_val}"
                                 tal:attributes="checked replica == true_val;"
                                 id="esgfsearch-replica"/>
                          Including Replicas
                        </label>
                      </div>

                      <div class="checkbox">
                        <label>
                          <input type="checkbox" name="latest" value="${true_val}"
                                 tal:attributes="checked latest == true_val;"
                                 id="esgfsearch-latest"/>
                          Latest Version
                        </label>
                      </div>

                      <div class="checkbox">
                        <label>
                          <input type="checkbox" name="temporal" value="${true_val}"
                                 tal:attributes="checked temporal == true_val;"
                                 id="esgfsearch-temporal"/>
                          Temporal Search
                        </label>
                      </div>

                    </div>
                  </div>
                </div>

                <!-- type -->
                <div class="panel panel-default">
                  <div class="panel-heading" role="tab" id="heading-type">
                    <h4 class="panel-title">
                      <a data-toggle="collapse" href="#collapse-type" aria-expanded="false" aria-controls="collapse-type">
                        <i class="fa fa-chevron-down"></i> TYPE
                      </a>
                    </h4>
                  </div>
                  <div id="collapse-type" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="heading-type">
                    <div class="panel-body">
                      <div class="radio">
                        <label>
                          <input type="radio" name="search_type" value="Dataset"
                                 tal:attributes="checked search_type == 'Dataset';"
                                 id="esgfsearch-dataset-type"/>
                          Dataset (Thredds Catalog)
                        </label>
                      </div>

                      <div class="radio">
                        <label>
                          <input type="radio" name="search_type" value="Aggregation"
                                 tal:attributes="checked search_type == 'Aggregation';"
                                 id="esgfsearch-aggregation-type"/>
                          Aggregation (OpenDAP)
                        </label>
                      </div>

                      <div class="radio">
                        <label>
                          <input type="radio" name="search_type" value="File"
                                 tal:attributes="checked search_type == 'File';"
                                 id="esgfsearch-file-type"/>
                          File (File download, OpenDAP)
                        </label>
                      </div>
                    </div>

                  </div>
                </div>

                <!-- date -->
                <div class="panel panel-default">
                  <div class="panel-heading" role="tab" id="heading-date">
                    <h4 class="panel-title">
                      <a data-toggle="collapse" href="#collapse-date" aria-expanded="false" aria-controls="collapse-date">
                        <i class="fa fa-chevron-down"></i> DATE
                      </a>
                    </h4>
                  </div>
                  <div id="collapse-date" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="heading-date">
                    <div class="panel-body">
                      <label>Start Year:</label>
                      <input type="text" name="start" value="${start}" class="form-control"
                             maxlength="4"
                             id="esgfsearch-start"/>
                      <label>End Year:</label>
                      <input type="text" name="end" value="${end}" class="form-control"
                             maxlength="4"
                             id="esgfsearch-end"/>
                    </div>
                  </div>
                 </div>
              </div>
            </div>

            <!-- search column -->

            <div class="col-md-9">

              <!-- status -->
              <label for="esgfsearch-hit-count" id="tm-hit-count">
                <input type="hidden" name="hit-count" value="${hit_count}"
                       id="esgfsearch-hit-count"/>
                Total: ${hit_count}
              </label>

              <!-- selection -->
              <div class="row">
                <div class="panel panel-default">
                  <div class="panel-heading">
                    <h4 class="panel-title">SELECTION</h4>
                  </div>
                  <div class="panel-body">
                    <input type="text" name="pinned" class="tm-pinned-facets"
                           id="tm-pinned-facets"/>
                    <input type="text" name="selection" class="tm-selection"
                           id="tm-selection"/>
                    <input type="hidden" name="constraints" value="${constraints}"
                           id="esgfsearch-constraints">
                  </div>
                </div>
              </div>

              <!-- categories -->
              <div class="row">
                <div class="panel panel-default">
                  <div class="panel-heading">
                    <h4 class="panel-title">CATEGORIES</h4>
                  </div>
                  <div class="panel-body">
                    <input type="text" name="Search Categories" class="tm-facets"
                           id="tm-facets"/>
                  </div>
                </div>
              </div>

              <!-- keywords -->
              <div class="row">
                <div class="panel panel-default">
                  <div class="panel-heading">
                    <h4 class="panel-title" id="search-label-category">KEYWORDS: ${selected}</h4>
                  </div>
                  <div class="panel-body">
                    <input type="text" name="Categorie: xxx" class="tm-facet"
                           id="tm-facet"/>
                  </div>
                </div>
              </div>

              <!-- pagination -->
              <div class="row">
                <ul class="pagination pagination-sm pull-left">
                  <li class="previous" tal:attributes="class 'previous' if page > 0 else 'previous disabled'">
                    <a href="">
                      <strong><i class="fa fa-angle-left"></i></strong>
                      </a>
                  </li>

                  <li class="next" tal:attributes="class 'next' if 10 < hit_count else 'next disabled'">
                    <a href="">
                      <strong><i class="fa fa-angle-right"></i></strong>
                    </a>
                  </li>
                </ul>

                <h3 class="pull-right"> Showing 0-10 of ${hit_count} </h3>
              </div>

              <!-- items -->
              <div class="row">
                <ul class="list-group">
                  <li class="list-group-item" tal:repeat="result results">
                    <div class="media">
                      <div class="media-body">
                        <div class="media-heading">
                          <h4>${result.title}</h4>
                        </div>
                        <p>
                          <a tal:condition="'catalog_url' in result" href="${result.catalog_url}" target="_">
                            <i class="fa fa-book"></i> Catalog</a>
                          <a tal:condition="'download_url' in result" href="${result.download_url}">
                            <i class="fa fa-download"></i> Download</a>
                          <a tal:condition="'opendap_url' in result" href="${result.opendap_url+'.html'}" target="_">
                            <i class="fa fa-cube"></i> OpenDAP</a>
                        </p>

                      </div>
                    </div>
                  </li>
                </ul>
              </div>

            </div>
          </div>
        </div>

      </div>

      <tal:form replace="structure form">The form will render here</tal:form>
    </div>
  </div>

</metal:block>
